{"version":3,"file":"course.js","sources":["pages/course/course.vue","pages/course/course.vue?type=page"],"sourcesContent":["<template>\r\n    <view class=\"course\" v-if=\"isShowPage\">\r\n        <div class=\"course-tools\">\r\n            <div class=\"class\">\r\n                <div class=\"title\">\r\n                    <span style=\"text-decoration: underline\" @click=\"gotoPage('home')\">首页</span>\r\n                    <span @click=\"isShowSelectClass = true\">{{ indexData.className }}<span style=\"text-decoration: underline\">(更改)</span></span>\r\n                    <span style=\"text-decoration: underline\" @click=\"gotoCurrentDay\">今天</span>\r\n                </div>\r\n                <select-class type=\"student\" @hide-select-class=\"hiddenSelectClass\" v-if=\"isShowSelectClass\"></select-class>\r\n            </div>\r\n            <div class=\"week-day\">\r\n                <courseDate-weekDay\r\n                    ref=\"weekDayComponent\"\r\n                    :hasCourseList=\"hasCourseWeekDayList\"\r\n                    @changeWeekDay=\"changeWeekDay\"\r\n                    :date=\"currentDate\"\r\n                    v-model=\"indexData.weekDay\"\r\n                ></courseDate-weekDay>\r\n            </div>\r\n            <courseDate-week ref=\"weekComponent\" @selectDate=\"selectDate\" @changeWeek=\"changeWeek\" v-model=\"indexData.week\"></courseDate-week>\r\n        </div>\r\n        <div @touchend=\"silder\" class=\"course-content\">\r\n            <div class=\"empty\" v-if=\"courseData.courseList.length === 0\">\r\n                <p>恭喜你,今天可以休息了</p>\r\n            </div>\r\n            <div v-else class=\"course-list\">\r\n                <!-- <courseItem :courseData='data' v-for='data in courseData.courseList' :key='data.id'></courseItem> -->\r\n                <div class=\"course-item\" v-for=\"data in courseData.courseList\" :key=\"data.id\">\r\n                    <div class=\"title\">\r\n                        <image style=\"width: 35rpx; height: 35rpx; margin-right: 10rpx\" src=\"../../static/时钟.png\" mode=\"\"> </image>\r\n                        <p>{{ data.courseSection }}</p>\r\n                        <p>{{ sectionTimeMap[data.courseSection] }}</p>\r\n                    </div>\r\n                    <div class=\"name\">\r\n                        <p>课程:</p>\r\n                        <span>{{ data.courseName }}</span>\r\n                    </div>\r\n                    <div class=\"position\">\r\n                        <p>地点:</p>\r\n                        <span>{{ data.coursePosition }}</span>\r\n                    </div>\r\n                    <div class=\"teacher\">\r\n                        <p>教师:</p>\r\n                        <span>{{ data.courseTeacher }}</span>\r\n                    </div>\r\n                    <div class=\"week\">\r\n                        <p>周次:</p>\r\n                        <span>{{ data.courseWeek.replaceAll(\"周\", \"\") }}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { getCurrentDate } from \"@/uilts/time.js\";\r\nimport { getCourseDataAPIplus, getStudentWeekHasCourseDayListAPI } from \"@/API/course.js\";\r\nimport { ref, reactive, watch,onMounted } from \"vue\";\r\nimport { onShow } from \"@dcloudio/uni-app\";\r\nimport { debounce } from \"../../uilts/debounce\";\r\n\r\nconst courseData = ref({\r\n    courseList: [],\r\n});\r\nconst sectionTimeMap = {\r\n    第一大节: \"8.30-10.00\",\r\n    第二大节: \"10.20-11.50\",\r\n    第三大节: \"14.00-15.30\",\r\n    第四大节: \"15.50-17.20\",\r\n    第五大节: \"18.40-20.10\",\r\n    第六大节: \"20.20-21.50\",\r\n};\r\n// 是否加载页面\r\nconst isShowPage = ref(false);\r\nconst isShowSelectClass = ref(false);\r\nconst currentDate = ref(new Date());\r\n// 查询数据\r\nconst indexData = reactive({});\r\n// 当前组件,用于触发当前日期时间更新\r\nconst weekComponent = ref(null);\r\nconst weekDayComponent = ref(null);\r\nconst hasCourseWeekDayList = ref([]);\r\nconst sectionSortIndex = {\r\n    第一大节: 1,\r\n    第二大节: 2,\r\n    第三大节: 3,\r\n    第四大节: 4,\r\n    第五大节: 5,\r\n    第六大节: 6,\r\n};\r\nconst touchStartX = ref(0);\r\n\r\n// function touchStart(e) {\r\n// \ttouchStartX.value = e.touches[0].clientX;\r\n// }\r\n\r\n// function silder(e) {\r\n// \tlet deltaX = e.changedTouches[0].clientX - touchStartX.value;\r\n// \tif (Math.abs(deltaX) > 130) {\r\n// \t\tif (deltaX >= 0) {\r\n// \t\t\tif (currentDate.value.getDate() === 1) {\r\n// \t\t\t\tuni.showToast({\r\n// \t\t\t\t\ttitle: \"暂不支持切换\",\r\n// \t\t\t\t\ticon: 'error'\r\n// \t\t\t\t})\r\n// \t\t\t\treturn\r\n// \t\t\t}\r\n\r\n// \t\t\tif (indexData.weekDay === '星期一') {\r\n// \t\t\t\tweekComponent.value.prevWeek()\r\n// \t\t\t}\r\n// \t\t\tweekDayComponent.value.prevWeekDay()\r\n\r\n// \t\t} else {\r\n// \t\t\tconst month = currentDate.value.getMonth() + 1\r\n// \t\t\tif (currentDate.value.getDate() === monthMap[month]) {\r\n// \t\t\t\t// const newDate = new Date()\r\n// \t\t\t\t// newDate.setDate(1)\r\n// \t\t\t\t// newDate.setMonth(newDate.getMonth() + 1)\r\n// \t\t\t\t// currentDate.value = newDate\r\n// \t\t\t\t// const date = {\r\n// \t\t\t\t// \tday: newDate.getDate(),\r\n// \t\t\t\t// \tmonth: newDate.getMonth() + 1\r\n// \t\t\t\t// }\r\n// \t\t\t\t// changeWeekDay(date)\r\n// \t\t\t\t// return\r\n// \t\t\t\tuni.showToast({\r\n// \t\t\t\t\ttitle: \"暂不支持切换\",\r\n// \t\t\t\t\ticon: 'error'\r\n// \t\t\t\t})\r\n// \t\t\t\treturn\r\n// \t\t\t}\r\n// \t\t\tif (indexData.weekDay === '星期日') {\r\n// \t\t\t\tweekComponent.value.nextWeek()\r\n// \t\t\t}\r\n// \t\t\tweekDayComponent.value.nextWeekDay()\r\n// \t\t}\r\n// \t}\r\n// }\r\n\r\nfunction sortCourseSection() {\r\n    courseData.value.courseList.sort((a, b) => {\r\n        return sectionSortIndex[a.courseSection] - sectionSortIndex[b.courseSection];\r\n    });\r\n}\r\n\r\nfunction selectDate(weekDay) {\r\n    indexData.weekDay = weekDay;\r\n}\r\n\r\nfunction changeWeekDay(date) {\r\n    weekComponent.value.setCurrentTime(date);\r\n}\r\n\r\nfunction gotoCurrentDay() {\r\n    const { week, weekDay } = getCurrentDate();\r\n\r\n    indexData.week = week;\r\n    indexData.weekDay = weekDay;\r\n    indexData.className = uni.getStorageSync(\"home-active-type\") === \"student\" ? uni.getStorageSync(\"home-active-val\") : \"软件2303班\";\r\n    currentDate.value = new Date();\r\n    const date = {\r\n        month: currentDate.value.getMonth() + 1,\r\n        day: currentDate.value.getDate(),\r\n    };\r\n    weekComponent.value.setCurrentTime(date);\r\n    weekComponent.value.getCurrentWeek();\r\n}\r\n\r\nfunction gotoPage(index) {\r\n    uni.navigateBack({\r\n        url: `/pages/${index}/${index}`,\r\n    });\r\n}\r\n\r\nfunction hiddenSelectClass(val) {\r\n    isShowSelectClass.value = false;\r\n    indexData.className = val;\r\n    uni.setStorageSync(\"home-active-type\", \"student\");\r\n    uni.setStorageSync(\"home-active-val\", val);\r\n    getCourseData();\r\n    getWeekHasCourseDayList();\r\n}\r\n\r\nfunction changeWeek(newDate) {\r\n    console.log(newDate);\r\n    currentDate.value = new Date(newDate);\r\n}\r\n\r\nfunction injectElectives() {\r\n    const electivesDataList = uni.getStorageSync(\"electivesDataList\");\r\n    if (electivesDataList) {\r\n        electivesDataList.forEach(dataList => {\r\n            dataList.forEach(d => {\r\n                if (indexData.week === d.week && indexData.weekDay === d.courseWeekDay) {\r\n                    courseData.value.courseList.push(d);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nasync function getCourseData() {\r\n    uni.showLoading({\r\n        title: \"加载中...\",\r\n    });\r\n    const weekStr = `第${indexData.week}周`;\r\n    const { data } = await getCourseDataAPIplus({\r\n        className: indexData.className,\r\n        weekDay: indexData.weekDay,\r\n        week: weekStr,\r\n    });\r\n    courseData.value = data.data;\r\n    courseData.value.courseList = Object.values(courseData.value.courseList);\r\n    injectElectives();\r\n    sortCourseSection();\r\n    setTimeout(() => {\r\n        uni.hideLoading();\r\n    }, 100);\r\n}\r\nasync function getWeekHasCourseDayList() {\r\n    const electivesWeekDayList = uni.getStorageSync(\"electivesDataList\") || [];\r\n    const weekStr = `第${indexData.week}周`;\r\n    const data = {\r\n        className: indexData.className,\r\n        week: weekStr,\r\n    };\r\n    const res = await getStudentWeekHasCourseDayListAPI(data);\r\n\r\n    hasCourseWeekDayList.value = res.data.data;\r\n    electivesWeekDayList.forEach(dataList => {\r\n        dataList.some(d => {\r\n            if (indexData.week === d.week) {\r\n                hasCourseWeekDayList.value.push(d.courseWeekDay);\r\n                return true;\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nwatch(\r\n    () => indexData.week,\r\n    debounce(() => {\r\n        getCourseData();\r\n        getWeekHasCourseDayList();\r\n    }, 100)\r\n);\r\nwatch(\r\n    () => indexData.weekDay,\r\n    debounce(() => {\r\n        getCourseData();\r\n    }, 100)\r\n);\r\n\r\nonMounted(async () => {\r\n    isShowPage.value = true;\r\n    const { week, weekDay } = getCurrentDate();\r\n    indexData.week = week;\r\n    indexData.weekDay = weekDay;\r\n    indexData.className = uni.getStorageSync(\"home-active-type\") === \"student\" ? uni.getStorageSync(\"home-active-val\") : \"软件2303班\";\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.course {\r\n    height: 100vh;\r\n    overflow-x: hidden;\r\n\r\n    .course-tools {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        flex-wrap: wrap;\r\n        flex-direction: column;\r\n        font-size: 28rpx;\r\n\r\n        .class {\r\n            width: 100vw;\r\n            padding: 30rpx 0;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: flex-start;\r\n            font-weight: bold;\r\n            background-color: #f5f5f5;\r\n            letter-spacing: 1rpx;\r\n            cursor: pointer;\r\n\r\n            .title {\r\n                width: 100%;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: space-between;\r\n                padding: 0 20rpx;\r\n            }\r\n\r\n            > label {\r\n                margin: 0 10rpx;\r\n            }\r\n        }\r\n    }\r\n\r\n    .course-content {\r\n        width: 95%;\r\n        height: 80vh;\r\n        display: flex;\r\n        align-items: flex-start;\r\n        justify-content: flex-end;\r\n        margin: 0 auto;\r\n        margin-top: 20rpx;\r\n\r\n        .empty {\r\n            width: 100vw;\r\n            display: flex;\r\n            align-items: flex-start;\r\n            justify-content: center;\r\n            padding: 20rpx;\r\n            font-size: 36rpx;\r\n        }\r\n\r\n        .course-list {\r\n            width: 100%;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            flex-wrap: wrap;\r\n\r\n            .course-item {\r\n                width: 100%;\r\n                padding: 5px;\r\n                border-radius: 10rpx;\r\n                margin: 10px;\r\n                font-size: 30rpx;\r\n                background-color: #e9f3fb;\r\n                border: 1px solid #c3d8ee;\r\n\r\n                .title {\r\n                    font-size: 34rpx;\r\n                    color: #000;\r\n                    padding-bottom: 20rpx;\r\n                    border-bottom: 2px solid #0497ff;\r\n                    align-items: center;\r\n                }\r\n\r\n                > view {\r\n                    color: #333;\r\n                    margin: 10px;\r\n                    display: flex;\r\n                    align-items: first baseline;\r\n                    justify-content: flex-start;\r\n\r\n                    view {\r\n                        font-weight: bolder;\r\n                        margin-right: 15rpx;\r\n                        color: #333;\r\n                        width: fit-content;\r\n                        word-break: keep-all;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/pages/course/course.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","getCurrentDate","uni","getCourseDataAPIplus","getStudentWeekHasCourseDayListAPI","watch","debounce","onMounted","MiniProgramPage"],"mappings":"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"}