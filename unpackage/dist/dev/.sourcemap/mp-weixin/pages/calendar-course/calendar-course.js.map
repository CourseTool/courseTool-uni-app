{"version":3,"file":"calendar-course.js","sources":["pages/calendar-course/calendar-course.vue","pages/calendar-course/calendar-course.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"calendar-course\" v-if=\"isShowPage\">\n        <div @click=\"isShowSelectTech = true\" class=\"header\">\n            <p style=\"text-decoration: underline\">当前班级:{{ indexData.className }}更改</p>\n        </div>\n        <select-class v-if=\"isShowSelectTech\" type=\"student\" @hide-select-class=\"selectTech\"></select-class>\n        <uni-calendar\n            @monthSwitch=\"changeMonth\"\n            :selected=\"fillCourseDayList\"\n            :insert=\"true\"\n            :lunar=\"true\"\n            :start-date=\"semesterDate.start_date\"\n            :end-date=\"semesterDate.end_date\"\n            @change=\"changeDate\"\n        />\n        <div class=\"course-list\">\n            <div class=\"title\">\n                <p>{{ indexData.week }} {{ indexData.weekDay }} 课程列表</p>\n            </div>\n            <div v-if=\"courseDataList.courseList.length !== 0\" class=\"course-item\" v-for=\"d in courseDataList.courseList\" :key=\"d.id\">\n                <div class=\"left-index\">\n                    <div class=\"section\">\n                        <p>{{ d.courseSection }}</p>\n                    </div>\n                    <div class=\"time\">\n                        <p>{{ timeStampMap[d.courseSection].replace(\" \", \"-\") }}</p>\n                    </div>\n                </div>\n                <div class=\"right-course\">\n                    <div class=\"name\">\n                        <p class=\"title\">课程:</p>\n                        <p class=\"value\">{{ d.courseName }}</p>\n                    </div>\n                    <div class=\"position\">\n                        <p class=\"title\">地点:</p>\n                        <p class=\"value\">{{ d.coursePosition }}</p>\n                    </div>\n                </div>\n            </div>\n            <div class=\"empty\" v-else>\n                <p>今日无课</p>\n            </div>\n        </div>\n    </view>\n</template>\n\n<script setup>\nimport { reactive, ref, onMounted } from \"vue\";\nimport { getCurrentDate, timeStampMap, monthMap, getDateByWeekandWeekDay } from \"@/uilts/time.js\";\nimport { getCourseDataAPIplus, getCourseForCalendarAPI } from \"@/API/course.js\";\nimport { getCourseConfigAPISync } from \"@/API/config.js\";\n\nconst isShowSelectTech = ref(false);\n\nconst courseDataList = ref([]);\nconst isShowPage = ref(false);\nconst indexData = reactive({\n    year: \"\",\n    month: \"\",\n    className: \"\",\n    day: \"\",\n    week: \"\",\n    weekDay: \"\",\n});\nconst fillCourseDayList = ref([]);\nlet hasCourseDayList = ref([]);\nconst calendarWeekList = ref([]);\nconst calendarCourseDataList = ref([]);\nconst currentMonth = ref(\"\");\nconst currentDay = ref(\"\");\nconst sectionSortIndex = {\n    第一大节: 1,\n    第二大节: 2,\n    第三大节: 3,\n    第四大节: 4,\n    第五大节: 5,\n    第六大节: 6,\n};\nconst semesterDate = ref({});\n\nfunction sortCourseSection() {\n    courseDataList.value.courseList.sort((a, b) => {\n        return sectionSortIndex[a.courseSection] - sectionSortIndex[b.courseSection];\n    });\n}\n\nfunction selectTech(val) {\n    indexData.className = val;\n    isShowSelectTech.value = false;\n    updateDate();\n    getCourse();\n    getMonthCourse();\n    uni.setStorageSync(\"home-active-type\", \"student\");\n    uni.setStorageSync(\"home-active-val\", val);\n}\n\nfunction changeMonth(e) {\n    if (indexData.year !== e.year) {\n        indexData.month = e.month + 12;\n    } else {\n        indexData.month = e.month;\n    }\n    indexData.year = e.year;\n    currentMonth.value = e.month;\n    currentDay.value = 1;\n    getMonthCourse();\n}\n\nasync function getMonthCourse() {\n    uni.showLoading({\n        title: \"加载中...\",\n    });\n    await getCourseForCalendar();\n    fillCalendar();\n    uni.hideLoading();\n    setTimeout(() => {\n        uni.hideLoading();\n        isShowPage.value = true;\n    }, 100);\n}\n\nasync function getCourse() {\n    const res = await getCourseDataAPIplus({\n        week: indexData.week,\n        weekDay: indexData.weekDay,\n        className: indexData.className,\n    });\n    courseDataList.value = res.data.data;\n    if (courseDataList.value.length != 0) {\n        courseDataList.value.courseList = Object.values(courseDataList.value.courseList);\n        sortCourseSection();\n    }\n}\n\nfunction changeDate(e) {\n    indexData.month = +e.month;\n    indexData.day = e.date;\n    indexData.year = e.year;\n    const { weekDay, weekStr } = getCurrentDate(indexData);\n    indexData.weekStr = weekStr;\n    indexData.week = weekStr;\n    indexData.weekDay = weekDay;\n    getCourse();\n}\n\nasync function getCourseForCalendar() {\n    hasCourseDayList.value = [];\n    genMonthWeek();\n    const data = {\n        weekList: calendarWeekList.value,\n        className: indexData.className,\n    };\n    const res = await getCourseForCalendarAPI(data);\n    calendarCourseDataList.value = res.data.data;\n    calendarCourseDataList.value.forEach(d => {\n        if (!!Object.keys(d.courseList).length) {\n            const date = {\n                week: d.week,\n                weekDay: d.weekDay,\n            };\n            const r = getDateByWeekandWeekDay(date);\n            console.log(r);\n            hasCourseDayList.value.push(r);\n        }\n    });\n}\n\nfunction genMonthWeek() {\n    calendarWeekList.value = [];\n    let month = indexData.month;\n    if (month > 12) {\n        indexData.month -= 12;\n        for (let i = 1; i <= monthMap[month - 12]; i++) {\n            let { weekStr } = getCurrentDate({\n                day: i,\n                month,\n            });\n            if (!calendarWeekList.value.includes(weekStr)) {\n                calendarWeekList.value.push(weekStr);\n            }\n        }\n    } else {\n        for (let i = 1; i <= monthMap[month]; i++) {\n            const { weekStr } = getCurrentDate({\n                day: i,\n                month: indexData.month,\n            });\n            if (!calendarWeekList.value.includes(weekStr)) {\n                calendarWeekList.value.push(weekStr);\n            }\n        }\n    }\n}\n\nfunction fillCalendar() {\n    const fillList = [];\n    const month = indexData.month;\n    for (let i = 1; i <= monthMap[month]; i++) {\n        const m = month.toString().padStart(2, 0);\n        const day = i;\n        const d = `${indexData.year}-${m}-${day}`;\n        if (hasCourseDayList.value.includes(d)) {\n            fillList.push({\n                date: d,\n                info: \"有课\",\n                data: {\n                    custom: \"自定义信息\",\n                    name: \"自定义消息头\",\n                },\n            });\n        }\n    }\n\n    fillCourseDayList.value = fillList;\n}\n\nfunction updateDate() {\n    const date = {\n        month: currentMonth.value,\n        day: currentDay.value,\n    };\n    const { weekStr, weekDay } = getCurrentDate(date);\n    indexData.week = weekStr;\n    indexData.weekDay = weekDay;\n}\n\nonMounted(async () => {\n    indexData.className = uni.getStorageSync(\"home-active-type\") === \"student\" ? uni.getStorageSync(\"home-active-val\") : \"软件2303班\";\n    const date = new Date();\n    const month = date.getMonth() + 1;\n    const day = date.getDate();\n    indexData.month = month;\n    indexData.day = day;\n    indexData.year = date.getFullYear();\n    currentMonth.value = month;\n    currentDay.value = day;\n    updateDate();\n    getCourse();\n    getMonthCourse();\n    const data = getCourseConfigAPISync();\n    semesterDate.value = data;\n});\n</script>\n\n<style lang=\"scss\">\n.header {\n    padding: 20rpx;\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #6598d9;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    letter-spacing: 2rpx;\n}\n\n.course-list {\n    margin: 0 auto;\n    padding: 20rpx 0;\n    width: 95vw;\n    border-top: 1px solid #ccc;\n\n    > .title {\n        font-size: 36rpx;\n        font-weight: bold;\n        margin: 30rpx 0;\n        text-align: center;\n        letter-spacing: 2rpx;\n    }\n\n    .course-item {\n        margin: 20rpx 0;\n        display: flex;\n        align-items: center;\n        justify-content: flex-start;\n\n        .left-index {\n            flex-basis: 21%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-direction: column;\n            color: #333;\n            margin-right: 20rpx;\n\n            > view {\n                width: fit-content;\n                word-break: keep-all;\n            }\n\n            .time {\n                color: #3c3c3c;\n                font-size: 22rpx;\n            }\n        }\n\n        .right-course {\n            flex-basis: 78%;\n            color: #6598d9;\n            padding: 20rpx;\n            background-color: #e9f3fb;\n            border-radius: 10rpx;\n            border: 1px solid #c3d8ee;\n\n            > view {\n                display: flex;\n                align-items: flex-start;\n                justify-content: flex-start;\n            }\n\n            .title {\n                font-size: 30rpx;\n                font-weight: bold;\n                margin-right: 10rpx;\n                width: fit-content;\n                word-break: keep-all;\n            }\n\n            .value {\n                font-size: 30rpx;\n            }\n        }\n    }\n\n    .empty {\n        font-size: 40rpx;\n        font-weight: bold;\n        margin-top: 50rpx;\n        color: #6598d9;\n        text-align: center;\n    }\n}\n</style>\n","import MiniProgramPage from '/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/pages/calendar-course/calendar-course.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni","getCourseDataAPIplus","getCurrentDate","getCourseForCalendarAPI","getDateByWeekandWeekDay","monthMap","onMounted","getCourseConfigAPISync","MiniProgramPage"],"mappings":"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"}