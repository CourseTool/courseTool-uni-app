{"version":3,"file":"calendar-tech-course.js","sources":["pages/calendar-tech-course/calendar-tech-course.vue","pages/calendar-tech-course/calendar-tech-course.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"calendar-tech-course\" v-if=\"isShowPage\">\n        <div @click=\"isShowSelectTech = true\" class=\"header\">\n            <p style=\"text-decoration: underline\">当前教师:{{ indexData.teacherName }}更改</p>\n        </div>\n        <select-class v-if=\"isShowSelectTech\" type=\"teacher\" @hide-select-class=\"selectTech\"></select-class>\n        <uni-calendar\n            @monthSwitch=\"changeMonth\"\n            :selected=\"fillCourseDayList\"\n            :insert=\"true\"\n            :lunar=\"true\"\n            :start-date=\"semesterDate.start_date\"\n            :end-date=\"semesterDate.end_date\"\n            @change=\"changeDate\"\n        />\n        <div class=\"course-list\">\n            <div class=\"title\">\n                <p>{{ indexData.week }} {{ indexData.weekDay }} 课程列表</p>\n            </div>\n            <div v-if=\"courseDataList.length !== 0\" class=\"course-item\" v-for=\"d in courseDataList.courseList\" :key=\"d.id\">\n                <div class=\"left-index\">\n                    <div class=\"section\">\n                        <p>{{ d.courseSection }}</p>\n                    </div>\n                    <div class=\"time\">\n                        <p>{{ timeStampMap[d.courseSection].replace(\" \", \"-\") }}</p>\n                    </div>\n                </div>\n                <div class=\"right-course\">\n                    <div class=\"name\">\n                        <p class=\"title\">课程:</p>\n                        <p class=\"value\">{{ d.courseName }}</p>\n                    </div>\n                    <div class=\"position\">\n                        <p class=\"title\">地点:</p>\n                        <p class=\"value\">{{ d.coursePosition }}</p>\n                    </div>\n                    <div class=\"class\">\n                        <p class=\"title\">班级:</p>\n                        <p class=\"value\">{{ d.courseClass }}</p>\n                    </div>\n                </div>\n            </div>\n            <div class=\"empty\" v-else>\n                <p>今日无课</p>\n            </div>\n        </div>\n    </view>\n</template>\n\n<script setup>\nimport { reactive, ref, onMounted } from \"vue\";\nimport { getCurrentDate, timeStampMap, monthMap, getDateByWeekandWeekDay } from \"@/uilts/time.js\";\nimport { getTeacherCourseAPI, getTechCourseForCalendarAPI } from \"@/API/course.js\";\nimport { getCourseConfigAPISync } from \"@/API/config.js\";\n\nconst isShowSelectTech = ref(false);\nconst courseDataList = ref([]);\nconst isShowPage = ref(false);\nconst indexData = reactive({\n    month: \"\",\n    teacher: \"\",\n    day: \"\",\n    week: \"\",\n    weekDay: \"\",\n});\nconst fillCourseDayList = ref([]);\nlet hasCourseDayList = [];\nconst calendarWeekList = ref([]);\nconst calendarCourseDataList = ref([]);\nconst currentMonth = ref(\"\");\nconst currentDay = ref(\"\");\nconst semesterDate = ref({});\n\nfunction selectTech(val) {\n    indexData.teacher = val;\n    isShowSelectTech.value = false;\n    updateDate();\n    getCourse();\n    getMonthCourse();\n    uni.setStorageSync(\"home-active-type\", \"teacher\");\n    uni.setStorageSync(\"home-active-val\", val);\n}\n\nfunction changeMonth(e) {\n    indexData.month = e.month;\n    indexData.year = e.year;\n    currentMonth.value = e.month;\n    currentDay.value = 1;\n    getMonthCourse();\n}\n\nasync function getMonthCourse() {\n    uni.showLoading({\n        title: \"加载中...\",\n    });\n    await getCourseForCalendar();\n    fillCalendar();\n    uni.hideLoading();\n}\n\nasync function getCourse() {\n    uni.showLoading({\n        title: \"加载中...\",\n    });\n    const res = await getTeacherCourseAPI({\n        week: indexData.week,\n        weekDay: indexData.weekDay,\n        teacherName: indexData.teacherName,\n    });\n    courseDataList.value = res.data.data;\n    setTimeout(() => {\n        uni.hideLoading();\n        isShowPage.value = true;\n    }, 100);\n}\n\nfunction changeDate(e) {\n    indexData.month = +e.month;\n    indexData.day = e.date;\n    const { weekDay, weekStr } = getCurrentDate(indexData);\n    indexData.week = weekStr;\n    indexData.weekDay = weekDay;\n    getCourse();\n}\n\nasync function getCourseForCalendar() {\n    hasCourseDayList = [];\n    genMonthWeek();\n    const data = {\n        weekList: calendarWeekList.value,\n        teacherName: indexData.teacherName,\n    };\n    const res = await getTechCourseForCalendarAPI(data);\n    calendarCourseDataList.value = res.data.data;\n    calendarCourseDataList.value.forEach(d => {\n        const date = {\n            week: d.week,\n            weekDay: d.weekDay,\n        };\n        const r = getDateByWeekandWeekDay(date);\n        hasCourseDayList.push(r);\n    });\n}\n\nfunction genMonthWeek() {\n    calendarWeekList.value = [];\n    const month = indexData.month;\n    for (let i = 1; i <= monthMap[month]; i++) {\n        const { weekStr } = getCurrentDate({\n            day: i,\n            month: indexData.month,\n        });\n        if (!calendarWeekList.value.includes(weekStr)) {\n            calendarWeekList.value.push(weekStr);\n        }\n    }\n}\n\nfunction fillCalendar() {\n    const fillList = [];\n    const month = indexData.month;\n    for (let i = 1; i <= monthMap[month]; i++) {\n        const m = month.toString().padStart(2, 0);\n        const day = i;\n        const d = `${indexData.year}-${m}-${day}`;\n        if (hasCourseDayList.includes(d)) {\n            fillList.push({\n                date: d,\n                info: \"有课\",\n            });\n        }\n    }\n\n    fillCourseDayList.value = fillList;\n}\n\nfunction updateDate() {\n    const date = {\n        month: currentMonth.value,\n        day: currentDay.value,\n    };\n    const { weekStr, weekDay } = getCurrentDate(date);\n    indexData.week = weekStr;\n    indexData.weekDay = weekDay;\n}\n\nonMounted(async () => {\n    indexData.teacherName = uni.getStorageSync(\"home-active-type\") === \"teacher\" ? uni.getStorageSync(\"home-active-val\") : \"吴宇飞\";\n    const date = new Date();\n    const month = date.getMonth() + 1;\n    const day = date.getDate();\n    const year = date.getFullYear();\n    indexData.month = month;\n    indexData.day = day;\n    indexData.year = year;\n    currentMonth.value = month;\n    currentDay.value = day;\n    updateDate();\n    getCourse();\n    getMonthCourse();\n    const data = getCourseConfigAPISync();\n    semesterDate.value = data;\n});\n</script>\n\n<style lang=\"scss\">\n.header {\n    padding: 20rpx;\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #6598d9;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    letter-spacing: 2rpx;\n}\n\n.course-list {\n    margin: 0 auto;\n    padding: 20rpx 0;\n    width: 95vw;\n    border-top: 1px solid #ccc;\n\n    > .title {\n        font-size: 36rpx;\n        font-weight: bold;\n        margin: 30rpx 0;\n        text-align: center;\n        letter-spacing: 2rpx;\n    }\n\n    .course-item {\n        margin: 20rpx 0;\n        display: flex;\n        align-items: center;\n        justify-content: flex-start;\n\n        .left-index {\n            flex-basis: 21%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-direction: column;\n            color: #333;\n            margin-right: 20rpx;\n\n            > view {\n                width: fit-content;\n                word-break: keep-all;\n            }\n\n            .time {\n                color: #3c3c3c;\n                font-size: 22rpx;\n\n                view {\n                    word-wrap: keep-all;\n                }\n            }\n        }\n\n        .right-course {\n            flex-basis: 78%;\n            color: #6598d9;\n            padding: 20rpx;\n            background-color: #e9f3fb;\n            border-radius: 10rpx;\n            border: 1px solid #c3d8ee;\n\n            > view {\n                display: flex;\n                align-items: flex-start;\n                justify-content: flex-start;\n            }\n\n            .title {\n                font-size: 30rpx;\n                font-weight: bold;\n                margin-right: 10rpx;\n                width: fit-content;\n                word-break: keep-all;\n            }\n\n            .value {\n                font-size: 30rpx;\n            }\n        }\n    }\n\n    .empty {\n        font-size: 40rpx;\n        font-weight: bold;\n        margin-top: 50rpx;\n        color: #6598d9;\n        text-align: center;\n    }\n}\n</style>\n","import MiniProgramPage from '/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/pages/calendar-tech-course/calendar-tech-course.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni","getTeacherCourseAPI","getCurrentDate","getTechCourseForCalendarAPI","getDateByWeekandWeekDay","monthMap","onMounted","getCourseConfigAPISync","MiniProgramPage"],"mappings":"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"}