{"version":3,"file":"time.js","sources":["uilts/time.js"],"sourcesContent":["import { getCourseConfigAPISync } from \"../API/config\";\r\nexport let COURSE_CONFIG = {};\r\nexport async function getCourseConfig() {\r\n    // const cache = uni.getStorageSync(\"course-config\");\r\n    // const cacheTime = uni.getStorageSync(\"course-config-time\");\r\n    // const date = new Date();\r\n    // if (cache && cacheTime - Date.parse(date) > 0) {\r\n    //     COURSE_CONFIG = cache;\r\n    // } else {\r\n    //     COURSE_CONFIG = await getCourseConfigAPISync();\r\n    //     date.setMonth(date.getMonth() + 4);\r\n    //     uni.setStorageSync(\"course-config\", COURSE_CONFIG);\r\n    //     uni.setStorageSync(\"course-config-time\", Date.parse(date));\r\n    // }\r\n    COURSE_CONFIG = await getCourseConfigAPISync();\r\n    uni.setStorageSync(\"course-config\", COURSE_CONFIG);\r\n}\r\n// getCourseConfig();\r\nexport default (index = \"data\") => {\r\n    let time = new Date();\r\n    let year = time.getFullYear();\r\n    let month = time.getMonth() + 1;\r\n    let day = time.getDate();\r\n    let hour = time.getHours();\r\n    let minute = time.getMinutes();\r\n    let second = time.getSeconds();\r\n    if (index === \"data\") {\r\n        return `${year}年${month}月${day}日${hour}时${minute}分${second}秒`;\r\n    } else if (index === \"yearmonth\") {\r\n        return `${year}年${month}月${day}日`;\r\n    } else {\r\n        return Date.parse(new Date());\r\n    }\r\n};\r\n\r\n// formatTime的计算[1-2,3-4]节次数据的辅助变量\r\nvar i = 0;\r\nexport function formatTime(timeData, type) {\r\n    const timeMap = {\r\n        \"01\": \"8.30-10.00\",\r\n        \"03\": \"10.20-11.50\",\r\n        \"05\": \"14.00-15.30\",\r\n        \"07\": \"15.50-17.20\",\r\n        \"09\": \"18.40-20.10\",\r\n        11: \"20.20-21.50\",\r\n    };\r\n\r\n    const t = timeData.split(\" \");\r\n    const week = t[0];\r\n    const weekDay = t[1];\r\n    const section = t[2];\r\n    const s = section.split(\"-\");\r\n    if (section.split(\"-\").length <= 2) {\r\n        const index = s[0].replace(\"[\", \"\");\r\n        return () => {\r\n            return type === \"easy\" ? timeMap[index] : timeMap[index] + \" \" + section;\r\n        };\r\n    } else {\r\n        return () => {\r\n            const index = s[i].replace(\"[\", \"\");\r\n            i += 2;\r\n            i = i === 4 ? 0 : i;\r\n            return type === \"easy\" ? timeMap[index] : timeMap[index] + \" \" + section;\r\n        };\r\n    }\r\n}\r\n\r\nexport const timeStampMap = {\r\n    第一大节: \"8:30 10:00\",\r\n    第二大节: \"10:20 11:50\",\r\n    第三大节: \"14:00 15:30\",\r\n    第四大节: \"15:50 17:20\",\r\n    第五大节: \"18:40 20:10\",\r\n    第六大节: \"20:20 21:50\",\r\n};\r\n\r\nfunction genMonthMap() {\r\n    const defaultMonthMap = {\r\n        1: 31,\r\n        2: 28,\r\n        3: 31,\r\n        4: 30,\r\n        5: 31,\r\n        6: 30,\r\n        7: 31,\r\n        8: 31,\r\n        9: 30,\r\n        10: 31,\r\n        11: 30,\r\n        12: 31,\r\n    };\r\n\r\n    let year = new Date().getFullYear();\r\n\r\n    if ((year % 4 === 0 && year % 100 != 0) || year % 400 === 0) {\r\n        defaultMonthMap[2] = 29;\r\n    }\r\n    return defaultMonthMap;\r\n}\r\nexport var monthMap = genMonthMap();\r\nconst weekDayMap = {\r\n    0: \"星期日\",\r\n    1: \"星期一\",\r\n    2: \"星期二\",\r\n    3: \"星期三\",\r\n    4: \"星期四\",\r\n    5: \"星期五\",\r\n    6: \"星期六\",\r\n};\r\n\r\nexport function calcTotal(date) {\r\n    const { month, day } = date;\r\n    let result = 0;\r\n    for (let d = 0; d < month - 1; d++) {\r\n        result += monthMap[d + 1];\r\n    }\r\n    result += day;\r\n    return result;\r\n}\r\n\r\nexport function calcTimeInterval(year, date1, date2) {\r\n    function isLeapYear(year) {\r\n        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;\r\n    }\r\n    if (isLeapYear(year)) monthMap[\"2\"] = 29;\r\n    const date1DayTotal = calcTotal(date1);\r\n    const date2DayTotal = calcTotal(date2);\r\n\r\n    return date1DayTotal - date2DayTotal;\r\n}\r\n\r\nexport function getCurrentDate(data) {\r\n    const date = new Date();\r\n    if (data) {\r\n        date.setFullYear(data.year || date.getFullYear());\r\n        if (data.month >= 13) {\r\n            date.setFullYear(date.getFullYear() + 1);\r\n            date.setMonth(data.month - 13);\r\n            date.setDate(data.day);\r\n        } else {\r\n            date.setFullYear(data.year || date.getFullYear());\r\n            date.setMonth(data.month - 1);\r\n            date.setDate(data.day);\r\n        }\r\n    } else {\r\n        date.setMonth(date.getMonth());\r\n    }\r\n    const month = date.getMonth() + 1;\r\n    const day = date.getDate();\r\n    const weekDay = date.getDay();\r\n    const d = {\r\n        month,\r\n        day,\r\n    };\r\n    if (month === 12) {\r\n        // debugger\r\n    }\r\n    let week = calcTotal(d) - COURSE_CONFIG.disDay;\r\n    if (week < 0) {\r\n        week = calcTotal({ month: 12, day: 31 }) + calcTotal(d) - COURSE_CONFIG.disDay;\r\n    }\r\n    let index = Math.floor(week / 7) + 1;\r\n    return {\r\n        week: index,\r\n        weekStr: `第${index}周`,\r\n        weekDay: `${weekDayMap[weekDay]}`,\r\n    };\r\n}\r\nexport function getDateByWeek(week) {\r\n    const result = [];\r\n    const date = new Date();\r\n\r\n    date.setDate(COURSE_CONFIG.start_day);\r\n    date.setMonth(COURSE_CONFIG.start_month - 1);\r\n    const weekDayMap = {\r\n        1: \"一\",\r\n        2: \"二\",\r\n        3: \"三\",\r\n        4: \"四\",\r\n        5: \"五\",\r\n        6: \"六\",\r\n        7: \"日\",\r\n    };\r\n    for (let i = 1; i < week; i++) {\r\n        date.setDate(date.getDate() + 7);\r\n        if (date.getDate() > monthMap[date.getMonth()]) {\r\n            date.setMonth(date.getMonth() + 1);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < 7; i++) {\r\n        result.push({\r\n            weekDay: weekDayMap[i + 1],\r\n            day: date.getDate(),\r\n        });\r\n        date.setDate(date.getDate() + 1);\r\n    }\r\n    return result;\r\n}\r\nexport function getDateByWeekandWeekDay(data) {\r\n    console.log(data);\r\n    let week = \"\";\r\n    if (data.week.length === 4) {\r\n        week = +data.week.substring(1, 3) - 1;\r\n    } else {\r\n        week = +data.week.substring(1, 2) - 1;\r\n    }\r\n    const weekDay = Object.values(weekDayMap).indexOf(data.weekDay);\r\n    const date = new Date();\r\n    date.setDate(COURSE_CONFIG.start_day);\r\n    date.setMonth(COURSE_CONFIG.start_month - 1);\r\n    date.setFullYear(COURSE_CONFIG.start_year || date.getFullYear());\r\n    for (let i = 0; i < week; i++) {\r\n        date.setDate(date.getDate() + 7);\r\n    }\r\n    const day = weekDay === 0 ? 7 : weekDay - 1;\r\n    date.setDate(date.getDate() + day);\r\n    const month = date.getMonth() + 1;\r\n    const m = month.toString().padStart(2, 0);\r\n    const d = date.getDate();\r\n    const y = date.getFullYear();\r\n    console.log(y);\r\n    return `${y}-${m}-${d}`;\r\n}\r\n/**\r\n * 根据周次推算月份\r\n * @param {number} week - 第几周（1 开始）\r\n * @param {number} year - 哪一年（默认当前年）\r\n * @returns {number} - 对应的月份 (1-12)\r\n */\r\nexport function getMonthByWeek(week, year = new Date().getFullYear()) {\r\n    console.log(week);\r\n    if (week < 1) throw new Error(\"周次不能小于 1\");\r\n\r\n    // 当年的第一天\r\n    const start = new Date(year, 0, 1); // 1月1日\r\n\r\n    // 偏移的天数 = (week-1)*7\r\n    const daysOffset = (week - 1) * 7;\r\n\r\n    // 计算日期\r\n    const target = new Date(start);\r\n    target.setDate(start.getDate() + daysOffset);\r\n\r\n    // 返回月份 (1-12)\r\n    return target.getMonth() + 1;\r\n}\r\n"],"names":["COURSE_CONFIG","getCourseConfigAPISync","uni","weekDayMap"],"mappings":"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"}