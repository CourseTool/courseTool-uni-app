{"version":3,"file":"mixin.js","sources":["uni_modules/wu-ui-tools/libs/mixin/mixin.js"],"sourcesContent":["import * as index from '../function/index.js';\nimport * as test from '../function/test.js';\n\nexport default {\n\t// 定义每个组件都可能需要用到的外部样式以及类名\n\tprops: {\n\t\t// 每个组件都有的父组件传递的样式，可以为字符串或者对象形式\n\t\tcustomStyle: {\n\t\t\ttype: [Object, String],\n\t\t\tdefault: () => ({})\n\t\t},\n\t\tcustomClass: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\t// 跳转的页面路径\n\t\turl: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\t// 页面跳转的类型\n\t\tlinkType: {\n\t\t\ttype: String,\n\t\t\tdefault: 'navigateTo'\n\t\t}\n\t},\n\tdata() {\n\t\treturn {}\n\t},\n\tonLoad() {\n\t\t// getRect挂载到$w上，因为这方法需要使用in(this)，所以无法把它独立成一个单独的文件导出\n\t\tthis.$w.getRect = this.$wuGetRect;\n\t},\n\tcreated() {\n\t\t// 组件当中，只有created声明周期，为了能在组件使用，故也在created中将方法挂载到$w\n\t\tthis.$w.getRect = this.$wuGetRect;\n\t},\n\tcomputed: {\n\t\t$w() {\n\t\t\treturn {\n\t\t\t\t...index,\n\t\t\t\ttest\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 生成bem规则类名\n\t\t * 由于微信小程序，H5，nvue之间绑定class的差异，无法通过:class=\"[bem()]\"的形式进行同用\n\t\t * 故采用如下折中做法，最后返回的是数组（一般平台）或字符串（支付宝和字节跳动平台），类似['a', 'b', 'c']或'a b c'的形式\n\t\t * @param {String} name 组件名称\n\t\t * @param {Array} fixed 一直会存在的类名\n\t\t * @param {Array} change 会根据变量值为true或者false而出现或者隐藏的类名\n\t\t * @returns {Array|string}\n\t\t */\n\t\tbem() {\n\t\t\treturn function(name, fixed, change) {\n\t\t\t\t// 类名前缀\n\t\t\t\tconst prefix = `wu-${name}--`\n\t\t\t\tconst classes = {}\n\t\t\t\tif (fixed) {\n\t\t\t\t\tfixed.map((item) => {\n\t\t\t\t\t\t// 这里的类名，会一直存在\n\t\t\t\t\t\tclasses[prefix + this[item]] = true\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (change) {\n\t\t\t\t\tchange.map((item) => {\n\t\t\t\t\t\t// 这里的类名，会根据this[item]的值为true或者false，而进行添加或者移除某一个类\n\t\t\t\t\t\tthis[item] ? (classes[prefix + item] = this[item]) : (delete classes[prefix + item])\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn Object.keys(classes)\n\t\t\t\t\t// 支付宝，头条小程序无法动态绑定一个数组类名，否则解析出来的结果会带有\",\"，而导致失效\n\t\t\t\t\t// #ifdef MP-ALIPAY || MP-TOUTIAO || MP-LARK || MP-BAIDU\n\t\t\t\t\t.join(' ')\n\t\t\t\t// #endif\n\t\t\t}\n\t\t}\n\t},\n\tmethods: {\n\t\t// 跳转某一个页面\n\t\topenPage(urlKey = 'url') {\n\t\t\tconst url = this[urlKey]\n\t\t\tif (url) {\n\t\t\t\t// 执行类似uni.navigateTo的方法\n\t\t\t\tuni[this.linkType]({\n\t\t\t\t\turl\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t// 查询节点信息\n\t\t// 目前此方法在支付宝小程序中无法获取组件跟接点的尺寸，为支付宝的bug(2020-07-21)\n\t\t// 解决办法为在组件根部再套一个没有任何作用的view元素\n\t\t$wuGetRect(selector, all) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tuni.createSelectorQuery()\n\t\t\t\t\t.in(this)[all ? 'selectAll' : 'select'](selector)\n\t\t\t\t\t.boundingClientRect((rect) => {\n\t\t\t\t\t\tif (all && Array.isArray(rect) && rect.length) {\n\t\t\t\t\t\t\tresolve(rect)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!all && rect) {\n\t\t\t\t\t\t\tresolve(rect)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.exec()\n\t\t\t})\n\t\t},\n\t\t// 查询节点布局是否相交\n\t\tIntersectionObserver(_this, nodeName, callback) {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t// #ifndef APP-NVUE || H5\n\t\t\t\tlet intersectionObserver = uni.createIntersectionObserver(_this)\n\t\t\t\tintersectionObserver.relativeToViewport({\n\t\t\t\t\tbottom: Number(this.lazyLoadRootMargin)\n\t\t\t\t}).observe(nodeName, res => {\n\t\t\t\t\tcallback(res, ()=>intersectionObserver.disconnect());\n\t\t\t\t})\n\t\t\t\t// #endif\n\t\t\t\t// #ifdef H5\n\t\t\t\tif (!window.__wu_observedComponents) window.__wu_observedComponents = new Map(); // 用于存储元素及其对应的回调函数\n\t\t\t\tif (!window.__wu_IntersectionObserver) {\n\t\t\t\t\twindow.__wu_IntersectionObserver = new IntersectionObserver((entries) => {\n\t\t\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\t\t\tconst callback = window.__wu_observedComponents.get(entry.target);\n\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\tcallback(entry, ()=>{\n\t\t\t\t\t\t\t\t\twindow.__wu_IntersectionObserver.unobserve(entry.target);\n\t\t\t\t\t\t\t\t\twindow.__wu_observedComponents.delete(entry.target);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}, {\n\t\t\t\t\t\troot: null,\n\t\t\t\t\t\trootMargin: Number(this.lazyLoadRootMargin) + 'px',\n\t\t\t\t\t\tthreshold: 0\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\twindow.__wu_observedComponents.set(_this.$el, callback);\n\t\t\t\twindow.__wu_IntersectionObserver.observe(_this.$el)\n\t\t\t\t// #endif\n\t\t\t})\n\t\t},\n\t\tgetParentData(parentName = '') {\n\t\t\t// 避免在created中去定义parent变量\n\t\t\tif (!this.parent) this.parent = {}\n\t\t\t// 这里的本质原理是，通过获取父组件实例(也即类似wu-radio的父组件wu-radio-group的this)\n\t\t\t// 将父组件this中对应的参数，赋值给本组件(wu-radio的this)的parentData对象中对应的属性\n\t\t\t// 之所以需要这么做，是因为所有端中，头条小程序不支持通过this.parent.xxx去监听父组件参数的变化\n\t\t\t// 此处并不会自动更新子组件的数据，而是依赖父组件wu-radio-group去监听data的变化，手动调用更新子组件的方法去重新获取\n\t\t\tthis.parent = this.$w.$parent.call(this, parentName)\n\t\t\tif (this.parent.children) {\n\t\t\t\t// 如果父组件的children不存在本组件的实例，才将本实例添加到父组件的children中\n\t\t\t\tthis.parent.children.indexOf(this) === -1 && this.parent.children.push(this)\n\t\t\t}\n\t\t\tif (this.parent && this.parentData) {\n\t\t\t\t// 历遍parentData中的属性，将parent中的同名属性赋值给parentData\n\t\t\t\tObject.keys(this.parentData).map((key) => {\n\t\t\t\t\tthis.parentData[key] = this.parent[key]\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t// 阻止事件冒泡\n\t\tpreventEvent(e) {\n\t\t\te && typeof(e.stopPropagation) === 'function' && e.stopPropagation()\n\t\t},\n\t\t// 空操作\n\t\tnoop(e) {\n\t\t\tthis.preventEvent(e)\n\t\t}\n\t},\n\tonReachBottom() {\n\t\tuni.$emit('wuOnReachBottom')\n\t},\n\tbeforeDestroy() {\n\t\t// 判断当前页面是否存在parent和chldren，一般在checkbox和checkbox-group父子联动的场景会有此情况\n\t\t// 组件销毁时，移除子组件在父组件children数组中的实例，释放资源，避免数据混乱\n\t\tif (this.parent && test.array(this.parent.children)) {\n\t\t\t// 组件销毁时，移除父组件中的children数组中对应的实例\n\t\t\tconst childrenList = this.parent.children\n\t\t\tchildrenList.map((child, index) => {\n\t\t\t\t// 如果相等，则移除\n\t\t\t\tif (child === this) {\n\t\t\t\t\tchildrenList.splice(index, 1)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n}"],"names":["index","test","uni","test.array"],"mappings":"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"}