{"version":3,"file":"courseDate-week.js","sources":["components/courseDate-week/courseDate-week.vue","/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/components/courseDate-week/courseDate-week.vue?type=component"],"sourcesContent":["<template>\r\n    <view class=\"week\">\r\n        <div class=\"prev-week\">\r\n            <span @click=\"prevWeek\">上一周</span>\r\n        </div>\r\n        <div class=\"current-week\">\r\n            <picker style=\"text-decoration: underline\" mode=\"date\" :value=\"currentTime\" :start=\"startDate\" :end=\"endDate\" @change=\"selectDate\">\r\n                <view class=\"uni-input\">{{ currentTime }}</view>\r\n            </picker>\r\n            <!-- <span @click=\"selectDate\" style=\"text-decoration: underline;\"> </span> -->\r\n            <span style=\"color: #0497ff; margin-left: 5rpx\"> 第{{ props.modelValue }}周</span>\r\n        </div>\r\n        <div class=\"next-week\">\r\n            <span @click=\"nextWeek\">下一周</span>\r\n        </div>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { calcTotal, monthMap, COURSE_CONFIG, getCurrentDate } from \"@/uilts/time.js\";\r\nimport { debounce } from \"@/uilts/debounce.js\";\r\nimport { getCourseConfigAPISync } from \"../../API/config\";\r\nimport { ref, defineProps, defineEmits, onMounted, watch } from \"vue\";\r\n\r\nconst props = defineProps([\"modelValue\"]);\r\nconst emit = defineEmits([\"update:modelValue\", \"changeWeek\", \"selectDate\"]);\r\nconst currentWeek = ref();\r\nconst currentTime = ref();\r\nconst currentDate = ref(new Date());\r\nconst cacheWeek = ref();\r\nconst courseConfig = ref({});\r\n\r\n// 选择日期\r\nlet startDate = \"\";\r\nlet endDate = \"\";\r\nconst weekDayMap = {\r\n    1: \"星期一\",\r\n    2: \"星期二\",\r\n    3: \"星期三\",\r\n    4: \"星期四\",\r\n    5: \"星期五\",\r\n    6: \"星期六\",\r\n    0: \"星期日\",\r\n};\r\n\r\nfunction nextWeek() {\r\n    if (currentWeek.value >= 25) {\r\n        uni.showToast({\r\n            title: \"已是最大周数\",\r\n            icon: \"error\",\r\n        });\r\n        return;\r\n    }\r\n    uni.showLoading({\r\n        title: \"加载中...\",\r\n    });\r\n    currentWeek.value += 1;\r\n\r\n    const nextWeekDate = new Date(currentDate.value);\r\n    const nextDay = currentDate.value.getDate() + 7;\r\n    let month = null;\r\n    if (nextWeekDate.getMonth() + 1 === 12 && nextDay > monthMap[nextWeekDate.getMonth() + 1]) {\r\n        nextWeekDate.setFullYear(nextWeekDate.getFullYear() + 1);\r\n        let day = nextDay - monthMap[12];\r\n        nextWeekDate.setMonth(0);\r\n        nextWeekDate.setDate(day);\r\n        month = 1;\r\n    } else {\r\n        month = currentDate.value.getMonth() + 1;\r\n        if (nextDay > monthMap[month]) {\r\n            nextWeekDate.setDate(nextDay - monthMap[month]);\r\n            month++;\r\n            nextWeekDate.setMonth(month - 1);\r\n        } else {\r\n            nextWeekDate.setDate(nextDay);\r\n        }\r\n    }\r\n    currentDate.value = nextWeekDate;\r\n    const day = currentDate.value.getDate();\r\n    currentTime.value = `${month}月${day}日`;\r\n    emit(\"update:modelValue\", currentWeek.value);\r\n    emit(\"changeWeek\", nextWeekDate);\r\n    setTimeout(() => {\r\n        uni.hideLoading();\r\n    }, 50);\r\n}\r\n\r\nfunction prevWeek() {\r\n    if (currentWeek.value <= 1) {\r\n        uni.showToast({\r\n            title: \"已是最小周数\",\r\n            icon: \"error\",\r\n        });\r\n        return;\r\n    }\r\n    uni.showLoading({\r\n        title: \"加载中...\",\r\n    });\r\n    currentWeek.value -= 1;\r\n\r\n    const prevWeekDate = new Date(currentDate.value);\r\n    const prevDay = currentDate.value.getDate() - 7;\r\n    const month = currentDate.value.getMonth() + 1;\r\n    if (prevWeekDate.getMonth() + 1 === 1 && prevDay <= 0) {\r\n        prevWeekDate.setFullYear(prevWeekDate.getFullYear() - 1);\r\n        let day = monthMap[12] - Math.abs(prevDay);\r\n        prevWeekDate.setMonth(11);\r\n        prevWeekDate.setDate(day);\r\n    } else {\r\n        if (prevDay <= 0) {\r\n            prevWeekDate.setMonth(month - 2);\r\n            prevWeekDate.setDate(monthMap[month - 1] + prevDay);\r\n        } else {\r\n            prevWeekDate.setDate(prevDay);\r\n        }\r\n    }\r\n    currentDate.value = prevWeekDate;\r\n    currentTime.value = `${currentDate.value.getMonth() + 1}月${currentDate.value.getDate()}日`;\r\n    emit(\"update:modelValue\", currentWeek.value);\r\n    emit(\"changeWeek\", prevWeekDate);\r\n    setTimeout(() => {\r\n        uni.hideLoading();\r\n    }, 50);\r\n}\r\n\r\nfunction getCurrentTime() {\r\n    const cMonth = currentDate.value.getMonth() + 1;\r\n    const cDay = currentDate.value.getDate();\r\n    currentTime.value = `${cMonth}月${cDay}日`;\r\n}\r\n\r\nfunction setCurrentTime(date) {\r\n    currentDate.value = new Date(currentDate.value);\r\n    currentDate.value.setDate(date.day);\r\n    currentDate.value.setMonth(date.month - 1);\r\n    currentTime.value = `${date.month}月${date.day}日`;\r\n}\r\n\r\nfunction getCurrentWeek() {\r\n    const cMonth = currentDate.value.getMonth() + 1;\r\n    const cDay = currentDate.value.getDate();\r\n    console.log(1111);\r\n    const data = getCurrentDate({\r\n        month: cMonth,\r\n        day: cDay,\r\n        year: currentDate.value.getFullYear(),\r\n    });\r\n    currentWeek.value = data.week;\r\n}\r\n\r\nfunction selectDate(e) {\r\n    var date = e.detail.value.split(\"-\");\r\n    date.shift();\r\n    const d = {\r\n        month: date[0].replace(\"0\", \"\"),\r\n        day: date[1].replace(\"0\", \"\"),\r\n    };\r\n    setCurrentTime(d);\r\n    getCurrentWeek();\r\n    emit(\"update:modelValue\", currentWeek.value);\r\n    emit(\"changeWeek\", currentDate.value);\r\n    const weekDay = currentDate.value.getDay();\r\n    emit(\"selectDate\", weekDayMap[weekDay]);\r\n}\r\n\r\nwatch(\r\n    () => props.modelValue,\r\n    (_, nv) => {\r\n        if (nv.modelValue === cacheWeek.value) {\r\n            getCurrentTime();\r\n        }\r\n    }\r\n);\r\n\r\ndefineExpose({\r\n    setCurrentTime,\r\n    getCurrentWeek,\r\n    nextWeek,\r\n    prevWeek,\r\n});\r\n\r\nonMounted(async () => {\r\n    startDate = COURSE_CONFIG.start_date;\r\n    endDate = COURSE_CONFIG.end_date;\r\n    console.log(startDate, endDate);\r\n    courseConfig.value = COURSE_CONFIG;\r\n    // getCurrentWeek()\r\n    getCurrentTime();\r\n    cacheWeek.value = props.modelValue;\r\n    currentWeek.value = props.modelValue;\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.week {\r\n    width: 100vw;\r\n    height: 100rpx;\r\n    background-color: #f5f5f5;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    font-size: 34rpx;\r\n    font-weight: bold;\r\n\r\n    > view {\r\n        margin: 0 25rpx;\r\n        text-decoration: underline;\r\n    }\r\n\r\n    .current-week {\r\n        font-size: 30rpx;\r\n        text-decoration: none;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n    }\r\n}\r\n</style>\r\n","import Component from '/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/components/courseDate-week/courseDate-week.vue'\nwx.createComponent(Component)"],"names":["ref","uni","monthMap","day","getCurrentDate","watch","onMounted","COURSE_CONFIG","Component"],"mappings":"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"}