{"version":3,"file":"home-course.js","sources":["components/home-course/home-course.vue","/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/components/home-course/home-course.vue?type=component"],"sourcesContent":["<template>\r\n    <view class=\"home-course\" v-if=\"isShowPage\">\r\n        <div class=\"course-update-time\">\r\n            <p>课表更新时间:{{ courseUpdateLogData.updateTime }}</p>\r\n        </div>\r\n        <div class=\"title\">\r\n            <p>{{ indexData.className }}今日课表</p>\r\n            <p style=\"font-size: 32rpx; color: #333; letter-spacing: 5rpx\">(第{{ indexData.week }}周{{ indexData.weekDay }})</p>\r\n        </div>\r\n        <div class=\"course-list\" v-if=\"courseData.courseList.length !== 0\">\r\n            <div class=\"course-item\" v-for=\"data in courseData.courseList\" :key=\"data.id\">\r\n                <div class=\"left-index\">\r\n                    <div class=\"section\">\r\n                        <p>\r\n                            {{ data.courseSection[0] }}\r\n                            <text style=\"font-weight: bold; color: #000; font-size: 30rpx\">{{ data.courseSection[1] }}</text>\r\n                            {{ data.courseSection.substring(2) }}\r\n                        </p>\r\n                    </div>\r\n                    <div class=\"time\">\r\n                        <p>{{ timeStampMap[data.courseSection].replace(\" \", \"-\") }}</p>\r\n                    </div>\r\n                </div>\r\n                <div class=\"right-course\">\r\n                    <div class=\"name\">\r\n                        <p class=\"title\">课程:</p>\r\n                        <p class=\"value\">{{ data.courseName }}</p>\r\n                    </div>\r\n                    <div class=\"position\">\r\n                        <p class=\"title\">地点:</p>\r\n                        <p class=\"value\">{{ data.coursePosition }}</p>\r\n                    </div>\r\n                    <div v-if=\"data.className\" class=\"class\">\r\n                        <p class=\"title\">班级</p>\r\n                        <p class=\"value\">{{ data.className }}</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"empty\" v-else>\r\n            <p>恭喜你,今天可以休息了!!!</p>\r\n        </div>\r\n    </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, reactive, ref, watch } from \"vue\";\r\nimport { getCurrentDate, timeStampMap } from \"@/uilts/time.js\";\r\nimport { getCourseDataAPIplus, getCourseUpdateLogAPI, getTeacherCourseAPI } from \"@/API/course.js\";\r\nimport { onLoad } from \"@dcloudio/uni-app\";\r\n\r\nconst isShowPage = ref(false);\r\nconst courseUpdateLogData = ref({});\r\nconst courseData = ref({\r\n    courseList: [],\r\n});\r\nlet indexData = reactive({\r\n    className: \"\",\r\n    week: \"\",\r\n    weekDay: \"\",\r\n});\r\nwatch(\r\n    () => indexData.week,\r\n    newVal => {\r\n        console.log(newVal);\r\n        if (isNaN(newVal)) {\r\n            console.log(\"触发\");\r\n            const { week } = getCurrentDate();\r\n            indexData.week = week;\r\n        }\r\n    }\r\n);\r\nconst sectionSortIndex = {\r\n    第一大节: 1,\r\n    第二大节: 2,\r\n    第三大节: 3,\r\n    第四大节: 4,\r\n    第五大节: 5,\r\n    第六大节: 6,\r\n};\r\n\r\nfunction sortCourseSection() {\r\n    courseData.value.courseList.sort((a, b) => {\r\n        return sectionSortIndex[a.courseSection] - sectionSortIndex[b.courseSection];\r\n    });\r\n}\r\n\r\nasync function getCourseData() {\r\n    // if (testCacheCourse()) {\r\n    // \tuni.hideLoading()\r\n    // \tcourseData.value = uni.getStorageSync(\"cacheCourse\").courseData\r\n    // \tcourseUpdateLogData.value = uni.getStorageSync(\"cacheLog\")\r\n    // \tisShowPage.value = true\r\n    // \treturn\r\n    // }\r\n    uni.showLoading({\r\n        title: \"加载中...\",\r\n    });\r\n    const weekStr = `第${indexData.week}周`;\r\n    const { data } = await getCourseDataAPIplus({\r\n        className: indexData.className,\r\n        weekDay: indexData.weekDay,\r\n        week: weekStr,\r\n    });\r\n    courseData.value = data.data;\r\n    courseData.value.courseList = Object.values(courseData.value.courseList);\r\n    console.log(courseData.value);\r\n    if (courseData.value.courseList.length != 0) {\r\n        sortCourseSection();\r\n    }\r\n    setTimeout(() => {\r\n        uni.hideLoading();\r\n        isShowPage.value = true;\r\n        // cacheCourse()\r\n        // // 缓存课表更新日志\r\n        // cacheLog()\r\n    }, 50);\r\n}\r\nasync function getTeacherCourse(d = indexData) {\r\n    // if (testCacheCourse()) {\r\n    // \tcourseData.value = uni.getStorageSync(\"cacheCourse\").courseData\r\n    // \tcourseUpdateLogData.value = uni.getStorageSync(\"cacheLog\")\r\n    // \tisShowPage.value = true\r\n    // \treturn\r\n    // }\r\n    uni.showLoading({\r\n        title: \"加载中...\",\r\n    });\r\n    const { data } = await getTeacherCourseAPI(d);\r\n    courseData.value.courseList = data.data;\r\n    setTimeout(() => {\r\n        uni.hideLoading();\r\n        isShowPage.value = true;\r\n    }, 50);\r\n}\r\n\r\nonLoad(async () => {\r\n    const { data } = await getCourseUpdateLogAPI();\r\n    courseUpdateLogData.value = data.data;\r\n    indexData.className = uni.getStorageSync(\"home-active-val\") || \"软件2303班\";\r\n    const { week, weekDay } = getCurrentDate();\r\n    indexData.week = week;\r\n    if (!indexData.week) {\r\n        const r = getCurrentDate();\r\n        indexData.week = r.week;\r\n    }\r\n    indexData.weekDay = weekDay;\r\n\r\n    // 查看有没有设置首页展示的内容\r\n    const homeActiveType = uni.getStorageSync(\"home-active-type\");\r\n    if (homeActiveType) {\r\n        const homeActiveVal = uni.getStorageSync(\"home-active-val\");\r\n        const weekStr = `第${indexData.week}周`;\r\n        if (homeActiveType === \"teacher\") {\r\n            const data = {\r\n                teacherName: homeActiveVal,\r\n                week: weekStr,\r\n                weekDay,\r\n            };\r\n            indexData.className = homeActiveVal;\r\n            getTeacherCourse(data);\r\n            return;\r\n        }\r\n        // 设置的展示学生班级\r\n        indexData.className = homeActiveVal;\r\n    }\r\n    getCourseData();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.home-course {\r\n    margin-top: 50rpx;\r\n    padding-bottom: 30rpx;\r\n\r\n    .course-update-time {\r\n        margin-top: 40rpx;\r\n        letter-spacing: 1px;\r\n        font-weight: bold;\r\n        text-align: center;\r\n        font-size: 20rpx;\r\n    }\r\n\r\n    > .title {\r\n        font-size: 44rpx;\r\n        letter-spacing: 1px;\r\n        font-weight: bold;\r\n        text-align: center;\r\n        margin-top: 30rpx;\r\n    }\r\n\r\n    .course-list {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        flex-direction: column;\r\n\r\n        .course-item {\r\n            margin-top: 30rpx;\r\n            width: 95vw;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n\r\n            .left-index {\r\n                width: 25%;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                flex-direction: column;\r\n                color: #666;\r\n                margin-right: 15rpx;\r\n\r\n                > view {\r\n                    font-size: 24rpx;\r\n                    font-weight: bold;\r\n                    width: fit-content;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n\r\n                    view {\r\n                        word-break: keep-all;\r\n                    }\r\n                }\r\n\r\n                .time {\r\n                    color: #3c3c3c;\r\n                    font-size: 24rpx;\r\n                }\r\n            }\r\n\r\n            .right-course {\r\n                width: 68vw;\r\n                padding: 10rpx 15rpx;\r\n                background-color: #e9f3fb;\r\n                border-radius: 10rpx;\r\n                border: 1px solid #c3d8ee;\r\n\r\n                > view {\r\n                    margin: 10rpx 0;\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: flex-start;\r\n                    color: #6598d9;\r\n                    line-height: 40rpx;\r\n\r\n                    .title {\r\n                        font-size: 30rpx;\r\n                        font-weight: bold;\r\n                        margin-right: 10rpx;\r\n                        width: fit-content;\r\n                        word-break: keep-all;\r\n                    }\r\n\r\n                    .value {\r\n                        font-size: 30rpx;\r\n                    }\r\n                }\r\n\r\n                .name {\r\n                    align-items: flex-start;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    .empty {\r\n        margin-top: 36rpx;\r\n        text-align: center;\r\n        font-size: 34rpx;\r\n        color: #0497ff;\r\n    }\r\n}\r\n</style>\r\n","import Component from '/Users/zhangrui/Library/Mobile Documents/com~apple~CloudDocs/Desktop/桌面/WeChatApp/course-wechat/components/home-course/home-course.vue'\nwx.createComponent(Component)"],"names":["ref","reactive","watch","uni","getCurrentDate","getCourseDataAPIplus","getTeacherCourseAPI","onLoad","getCourseUpdateLogAPI","data","Component"],"mappings":"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"}